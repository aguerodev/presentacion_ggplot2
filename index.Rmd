---
title: "Introducción a ggplot2"
subtitle: "Entendiendo la gramática<br>de los gráficos"
author: "Carlos Agüero"
date: "2021-11-17"
output:
  xaringan::moon_reader:
    seal: false
    css: ["default", "css/style.css"]
    lib_dir: libs
    nature:
      highlightLines: true
      countIncrementalSlides: false
      ratio: '16:9' 
      navigation:
        scroll: false 
---

```{r setup, include=FALSE}

options(htmltools.dir.version = FALSE,
        tibble.max_extra_cols = 6,
        tibble.width = 60)

knitr::opts_chunk$set(warning = FALSE,
                      message = FALSE,
                      fig.align = "center",
                      dpi = 400,
                      out.width = "95%",
                      out.height = "95%",
                      fig.retina = 3,
                      fig.asp = 9/16)
library(ggplot2)
library(datos)
```


```{r xaringanExtra-clipboard, echo=FALSE}
htmltools::tagList(
  xaringanExtra::use_clipboard(
    button_text = "<i class=\"fa fa-clipboard\"></i>",
    success_text = "<i class=\"fa fa-check\" style=\"color: #90BE6D\"></i>",
    error_text = "<i class=\"fa fa-times-circle\" style=\"color: #F94144\"></i>"
  ),
  rmarkdown::html_dependency_font_awesome()
)
```

```{r xaringan-themer, include=FALSE, warning=FALSE}
library(xaringanthemer)
style_mono_accent(
  title_slide_background_color = "white",
  title_slide_text_color = "#5E8B7E",
  header_h1_font_size = "45px",
  header_h2_font_size = "35px",
  header_color = "#5E8B7E",
  inverse_background_color = "#9FB8AD",
  text_bold_color = "#5E8B7E",
  text_bold_font_weight = "700",
  code_inline_color = "#B4C6A6",
  text_font_size = "28px",
  code_font_size = "24px",
  code_highlight_color = "#F7EFB2",
  header_font_google = google_font("Lora", "300", "300i",
                                   "400","400i", "700","700i"),
  text_font_google   = google_font("Montserrat", "300", "300i","700"),
  code_font_google   = google_font("Fira Code"),
  outfile = "css/style.css",
  extra_css = list("h1,h2,h3" = list("font-style" = "italic;"))
)
```

```{r metathis, echo=FALSE}
library(metathis)
meta() %>%
  meta_name("github-repo" ="aguerodev/presentacion_ggplot2") %>% 
  meta_social(
    title = "Introducción a ggplot2",
    description = paste(
      "Introducción a la gramática de los gráficos,",
      "desde 0 hasta gráficos listos para publicar."
    ),
    url = "https://aguerodev.github.io/presentacion_ggplot2",
    image = "https://raw.githubusercontent.com/allisonhorst/stats-illustrations/master/rstats-artwork/ggplot2_masterpiece.png",
    og_type = "website",
    og_author = "Carlos Agüero B",
    twitter_card_type = "summary_large_image",
    twitter_creator = "@dev_aguero",
    twitter_site = "@dev_aguero"
  )
```

class:left, middle, title-slide

# `r rmarkdown::metadata$title`

## `r rmarkdown::metadata$subtitle`

<br>

<div style = "position: absolute;top:80px;right: 10px;"><img src="https://raw.githubusercontent.com/allisonhorst/stats-illustrations/master/rstats-artwork/ggplot2_masterpiece.png" alt="A purple door with a stack of boxes stacked askew, falling to the left" width="600"></img><br>
<a href = "https://twitter.com/allison_horst" style = "font-size:16px;position: absolute;right: 10px;">Art by @allison_horst</a></div>

---
class: left, middle

# ¿Qué es una gramática?

La gramática tiene un significado técnico en lingüística. En la teoría transformacional de *Chomsky (1956)*, una gramática es un sistema formal de reglas para generar enunciados lícitos en una lengua.

---
class: left, middle

Un lenguaje compuesto por palabras y sin gramática (enunciado = palabra) sólo expresa **tantas ideas como palabras tiene**. Al especificar cómo se combinan las palabras en los enunciados, una gramática amplía el alcance de un lenguaje.

---
class: left, middle

Antes en R usabamos **plots (palabras)**, es decir, podiamos generar tantos gráficos como funciones estuvieran disponibles (no muchas).

```{r, eval=FALSE}
plot(...) # dispersion
barplot(...) # barras
pie(...) # pastel
hist(...) # histogramas
```


---
class: left, middle

Ahora tenemos una gramática que nos permite expresarnos de forma más fluida.

```{r, eval=FALSE}
ggplot(data = iris,
       mapping = aes(x = Sepal.Length,
                     y = Petal.Length,
                     color = Species)) +
  geom_point()
```

---
class: left, middle

.pull-left[
En **ggplot2** definimos nuestros gráficos como la unión una seria de capas entre las que tenemos:
]

.pull-right[

+ Datos
+ Geometrías (geom)
+ Estadísticos (stats)
+ Escalas (scales)
+ Coordenadas (coord)
+ Facetas (facets)
+ Etiquetas (labs)
+ Temas (themes)
]

---
class: left, middle

## Vamos poco a poco


---
class: left, middle

# Datos

---
class: left, middle

Trabajemos con una pequeña tabla muy conocida, .

```{r, echo=FALSE}
library(gt)
gt(head(flores)) %>% 
  tab_options(table.font.size = 28,
              column_labels.font.weight = "500")
```

---
class: left

.pull-left[
```{r, ggplot-1, eval=FALSE}
ggplot(data = flores)
```

Vamos a iniciar con la **capa de datos**,
cuando ejecutamos `ggplot(data = flores)` estamos indicando que estos son los datos con los que vamos a trabajar.

Vemos que el resultado es un lienzo gris, en donde más adelante dibujaremos nuestro gráfico.
]

.pull-right[
```{r ref.label="ggplot-1", fig.callout=TRUE, echo=FALSE, dev='svglite'}
``` 
]

---
class: left, middle

# Mapeo

---
class: left
El mapeo indica que codificación visual vamos a utilizar, es decir, que medio vamos a utilizar para representar nuestros datos, entre algunos de estos canales tenemos:

<center>
<img src = "img/elementos_visuales.png" width = "90%"></img>
</center>

---
class: left

.pull-left[
```{r, eval=FALSE}
ggplot(
  data = flores,
  mapping = aes(
    x = Largo.Sepalo, #<<
    y = Largo.Petalo,
    color = Especies
  )
)
```

Utilizando la función `aes` definimos cómo se van a codificar visualmente nuestros datos.

]

.pull-right[
```{r, echo=FALSE}
library(gt)
library(dplyr)

head(flores) %>% 
select(-contains("Ancho")) %>% 
gt() %>% 
   tab_spanner(
    label = "Eje x",
    columns = c(`Largo.Sepalo`)
  ) %>% 
  tab_spanner(
    label = "Eje y",
    columns = c(`Largo.Petalo`)
  ) %>% 
  tab_spanner(
    label = "Color",
    columns = c(`Especies`)
  ) %>% 
  tab_style(
    style = cell_fill(color = "#F7EFB2"),
    locations = cells_body(
      columns = "Largo.Sepalo"
  )) %>% 
  tab_style(
    style = cell_fill(color = "#F7EFB2"),
    locations = cells_column_labels(
      columns = "Largo.Sepalo"
  )) %>% 
  tab_style(
    style = cell_fill(color = "#F7EFB2"),
    locations = cells_column_spanners(
      spanners = "Eje x"
  )) %>% 
   tab_options(table.font.size = 28,
               column_labels.font.size = "30")
```

]

---
class: left

.pull-left[
```{r, eval=FALSE}
ggplot(
  data = flores,
  mapping = aes(
    x = Largo.Sepalo,
    y = Largo.Petalo, #<<
    color = Especies
  )
)
```

]

.pull-right[
```{r, echo=FALSE}
library(gt)
library(dplyr)

head(flores) %>% 
select(-contains("Ancho")) %>% 
gt() %>% 
   tab_spanner(
    label = "Eje x",
    columns = c(`Largo.Sepalo`)
  ) %>% 
  tab_spanner(
    label = "Eje y",
    columns = c(`Largo.Petalo`)
  ) %>% 
  tab_spanner(
    label = "Color",
    columns = c(`Especies`)
  ) %>% 
  tab_style(
    style = cell_fill(color = "#F7EFB2"),
    locations = cells_body(
      columns = "Largo.Petalo"
  )) %>% 
  tab_style(
    style = cell_fill(color = "#F7EFB2"),
    locations = cells_column_labels(
      columns = "Largo.Petalo"
  )) %>% 
  tab_style(
    style = cell_fill(color = "#F7EFB2"),
    locations = cells_column_spanners(
      spanners = "Eje y"
  )) %>% 
   tab_options(table.font.size = 28,
               column_labels.font.size = "30")
```

]


---
class: left

.pull-left[
```{r, eval=FALSE}
ggplot(
  data = flores,
  mapping = aes(
    x = Largo.Sepalo,
    y = Largo.Petalo,
    color = Especies #<<
  )
)
```

]

.pull-right[
```{r, echo=FALSE}
library(gt)
library(dplyr)

head(flores) %>% 
select(-contains("Ancho")) %>% 
gt() %>% 
   tab_spanner(
    label = "Eje x",
    columns = c(`Largo.Sepalo`)
  ) %>% 
  tab_spanner(
    label = "Eje y",
    columns = c(`Largo.Petalo`)
  ) %>% 
  tab_spanner(
    label = "Color",
    columns = c(`Especies`)
  ) %>% 
  tab_style(
    style = cell_fill(color = "#F7EFB2"),
    locations = cells_body(
      columns = "Especies"
  )) %>% 
  tab_style(
    style = cell_fill(color = "#F7EFB2"),
    locations = cells_column_labels(
      columns = "Especies"
  )) %>% 
  tab_style(
    style = cell_fill(color = "#F7EFB2"),
    locations = cells_column_spanners(
      spanners = "Color"
  )) %>% 
   tab_options(table.font.size = 28,
               column_labels.font.size = "30")
```

]
 

 
 
---
class:left 

.pull-left[
```{r, ggplot-2, eval=FALSE}
ggplot(
  data = flores,
  mapping = aes(
    x = Largo.Sepalo,
    y = Largo.Petalo,
    color = Especies
  )
)
```

Tenemos como resultado un pequeño gráfico en donde ya tenemos valores definidos para los ejes `x,y`.
]

.pull-right[
```{r ref.label="ggplot-2", fig.callout=TRUE, echo=FALSE, dev='svglite'}
``` 

]
